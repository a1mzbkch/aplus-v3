var Qt=Object.defineProperty;var rt=e=>{throw TypeError(e)};var er=(e,t,r)=>t in e?Qt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var p=(e,t,r)=>er(e,typeof t!="symbol"?t+"":t,r),We=(e,t,r)=>t.has(e)||rt("Cannot "+r);var l=(e,t,r)=>(We(e,t,"read from private field"),r?r.call(e):t.get(e)),g=(e,t,r)=>t.has(e)?rt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),f=(e,t,r,s)=>(We(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),y=(e,t,r)=>(We(e,t,"access private method"),r);var st=(e,t,r,s)=>({set _(i){f(e,t,i,r)},get _(){return l(e,t,s)}});var bt={Stringify:1},X=(e,t)=>{const r=new String(e);return r.isEscaped=!0,r.callbacks=t,r},tr=/[&<>'"]/,rr=async(e,t)=>{let r="";t||(t=[]);const s=await Promise.all(e);for(let i=s.length-1;r+=s[i],i--,!(i<0);i--){let n=s[i];typeof n=="object"&&t.push(...n.callbacks||[]);const a=n.isEscaped;if(n=await(typeof n=="object"?n.toString():n),typeof n=="object"&&t.push(...n.callbacks||[]),n.isEscaped??a)r+=n;else{const o=[r];le(n,o),r=o[0]}}return X(r,t)},le=(e,t)=>{const r=e.search(tr);if(r===-1){t[0]+=e;return}let s,i,n=0;for(i=r;i<e.length;i++){switch(e.charCodeAt(i)){case 34:s="&quot;";break;case 39:s="&#39;";break;case 38:s="&amp;";break;case 60:s="&lt;";break;case 62:s="&gt;";break;default:continue}t[0]+=e.substring(n,i)+s,n=i+1}t[0]+=e.substring(n,i)},sr=e=>{const t=e.callbacks;if(!(t!=null&&t.length))return e;const r=[e],s={};return t.forEach(i=>i({phase:bt.Stringify,buffer:r,context:s})),r[0]},Pt=async(e,t,r,s,i)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const n=e.callbacks;return n!=null&&n.length?(i?i[0]+=e:i=[e],Promise.all(n.map(o=>o({phase:t,buffer:i,context:s}))).then(o=>Promise.all(o.filter(Boolean).map(c=>Pt(c,t,!1,s,i))).then(()=>i[0]))):Promise.resolve(e)},Ot=Symbol("RENDERER"),ir=Symbol("ERROR_HANDLER"),nr=Symbol("INTERNAL"),Te=Symbol("PERMALINK"),it=e=>(e[nr]=!0,e),ar=e=>({value:t,children:r})=>{if(!r)return;const s={children:[{tag:it(()=>{e.push(t)}),props:{}}]};Array.isArray(r)?s.children.push(...r.flat()):s.children.push(r),s.children.push({tag:it(()=>{e.pop()}),props:{}});const i={tag:"",props:s,type:""};return i[ir]=n=>{throw e.pop(),n},i},Xe=[],or=e=>{const t=[e],r=s=>{t.push(s.value);let i;try{i=s.children?(Array.isArray(s.children)?new Er("",{},s.children):s.children).toString():""}finally{t.pop()}return i instanceof Promise?i.then(n=>X(n,n.callbacks)):X(i)};return r.values=t,r.Provider=r,r[Ot]=ar(t),Xe.push(r),r},Me=e=>e.values.at(-1),cr={title:[],script:["src"],style:["data-href"],link:["href"],meta:["name","httpEquiv","charset","itemProp"]},nt={},lr="data-precedence",He=e=>Array.isArray(e)?e:[e],at=new WeakMap,ot=(e,t,r,s)=>({buffer:i,context:n})=>{if(!i)return;const a=at.get(n)||{};at.set(n,a);const o=a[e]||(a[e]=[]);let c=!1;const u=cr[e];if(u.length>0){e:for(const[,d]of o)for(const h of u)if(((d==null?void 0:d[h])??null)===(r==null?void 0:r[h])){c=!0;break e}}if(c?i[0]=i[0].replaceAll(t,""):u.length>0?o.push([t,r,s]):o.unshift([t,r,s]),i[0].indexOf("</head>")!==-1){let d;if(s===void 0)d=o.map(([h])=>h);else{const h=[];d=o.map(([m,,C])=>{let b=h.indexOf(C);return b===-1&&(h.push(C),b=h.length-1),[m,b]}).sort((m,C)=>m[1]-C[1]).map(([m])=>m)}d.forEach(h=>{i[0]=i[0].replaceAll(h,"")}),i[0]=i[0].replace(/(?=<\/head>)/,d.join(""))}},qe=(e,t,r)=>X(new D(e,r,He(t??[])).toString()),Re=(e,t,r,s)=>{if("itemProp"in r)return qe(e,t,r);let{precedence:i,blocking:n,...a}=r;i=s?i??"":void 0,s&&(a[lr]=i);const o=new D(e,a,He(t||[])).toString();return o instanceof Promise?o.then(c=>X(o,[...c.callbacks||[],ot(e,c,a,i)])):X(o,[ot(e,o,a,i)])},ur=({children:e,...t})=>{const r=Ye();if(r){const s=Me(r);if(s==="svg"||s==="head")return new D("title",t,He(e??[]))}return Re("title",e,t,!1)},dr=({children:e,...t})=>{const r=Ye();return["src","async"].some(s=>!t[s])||r&&Me(r)==="head"?qe("script",e,t):Re("script",e,t,!1)},hr=({children:e,...t})=>["href","precedence"].every(r=>r in t)?(t["data-href"]=t.href,delete t.href,Re("style",e,t,!0)):qe("style",e,t),pr=({children:e,...t})=>["onLoad","onError"].some(r=>r in t)||t.rel==="stylesheet"&&(!("precedence"in t)||"disabled"in t)?qe("link",e,t):Re("link",e,t,"precedence"in t),fr=({children:e,...t})=>{const r=Ye();return r&&Me(r)==="head"?qe("meta",e,t):Re("meta",e,t,!1)},qt=(e,{children:t,...r})=>new D(e,r,He(t??[])),mr=e=>(typeof e.action=="function"&&(e.action=Te in e.action?e.action[Te]:void 0),qt("form",e)),Rt=(e,t)=>(typeof t.formAction=="function"&&(t.formAction=Te in t.formAction?t.formAction[Te]:void 0),qt(e,t)),gr=e=>Rt("input",e),vr=e=>Rt("button",e);const ze=Object.freeze(Object.defineProperty({__proto__:null,button:vr,form:mr,input:gr,link:pr,meta:fr,script:dr,style:hr,title:ur},Symbol.toStringTag,{value:"Module"}));var yr=new Map([["className","class"],["htmlFor","for"],["crossOrigin","crossorigin"],["httpEquiv","http-equiv"],["itemProp","itemprop"],["fetchPriority","fetchpriority"],["noModule","nomodule"],["formAction","formaction"]]),ct=e=>yr.get(e)||e,Cr=(e,t)=>{for(const[r,s]of Object.entries(e)){const i=r[0]==="-"||!/[A-Z]/.test(r)?r:r.replace(/[A-Z]/g,n=>`-${n.toLowerCase()}`);t(i,s==null?null:typeof s=="number"?i.match(/^(?:a|border-im|column(?:-c|s)|flex(?:$|-[^b])|grid-(?:ar|[^a])|font-w|li|or|sca|st|ta|wido|z)|ty$/)?`${s}`:`${s}px`:s)}},xe=void 0,Ye=()=>xe,xr=e=>/[A-Z]/.test(e)&&e.match(/^(?:al|basel|clip(?:Path|Rule)$|co|do|fill|fl|fo|gl|let|lig|i|marker[EMS]|o|pai|pointe|sh|st[or]|text[^L]|tr|u|ve|w)/)?e.replace(/([A-Z])/g,"-$1").toLowerCase():e,jr=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],wr=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","download","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Qe=(e,t)=>{for(let r=0,s=e.length;r<s;r++){const i=e[r];if(typeof i=="string")le(i,t);else{if(typeof i=="boolean"||i===null||i===void 0)continue;i instanceof D?i.toStringToBuffer(t):typeof i=="number"||i.isEscaped?t[0]+=i:i instanceof Promise?t.unshift("",i):Qe(i,t)}}},D=class{constructor(e,t,r){p(this,"tag");p(this,"props");p(this,"key");p(this,"children");p(this,"isEscaped",!0);p(this,"localContexts");this.tag=e,this.props=t,this.children=r}get type(){return this.tag}get ref(){return this.props.ref||null}toString(){var t,r;const e=[""];(t=this.localContexts)==null||t.forEach(([s,i])=>{s.values.push(i)});try{this.toStringToBuffer(e)}finally{(r=this.localContexts)==null||r.forEach(([s])=>{s.values.pop()})}return e.length===1?"callbacks"in e?sr(X(e[0],e.callbacks)).toString():e[0]:rr(e,e.callbacks)}toStringToBuffer(e){const t=this.tag,r=this.props;let{children:s}=this;e[0]+=`<${t}`;const i=xe&&Me(xe)==="svg"?n=>xr(ct(n)):n=>ct(n);for(let[n,a]of Object.entries(r))if(n=i(n),n!=="children"){if(n==="style"&&typeof a=="object"){let o="";Cr(a,(c,u)=>{u!=null&&(o+=`${o?";":""}${c}:${u}`)}),e[0]+=' style="',le(o,e),e[0]+='"'}else if(typeof a=="string")e[0]+=` ${n}="`,le(a,e),e[0]+='"';else if(a!=null)if(typeof a=="number"||a.isEscaped)e[0]+=` ${n}="${a}"`;else if(typeof a=="boolean"&&wr.includes(n))a&&(e[0]+=` ${n}=""`);else if(n==="dangerouslySetInnerHTML"){if(s.length>0)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");s=[X(a.__html)]}else if(a instanceof Promise)e[0]+=` ${n}="`,e.unshift('"',a);else if(typeof a=="function"){if(!n.startsWith("on")&&n!=="ref")throw new Error(`Invalid prop '${n}' of type 'function' supplied to '${t}'.`)}else e[0]+=` ${n}="`,le(a.toString(),e),e[0]+='"'}if(jr.includes(t)&&s.length===0){e[0]+="/>";return}e[0]+=">",Qe(s,e),e[0]+=`</${t}>`}},Be=class extends D{toStringToBuffer(e){const{children:t}=this,r={...this.props};t.length&&(r.children=t.length===1?t[0]:t);const s=this.tag.call(null,r);if(!(typeof s=="boolean"||s==null))if(s instanceof Promise)if(Xe.length===0)e.unshift("",s);else{const i=Xe.map(n=>[n,n.values.at(-1)]);e.unshift("",s.then(n=>(n instanceof D&&(n.localContexts=i),n)))}else s instanceof D?s.toStringToBuffer(e):typeof s=="number"||s.isEscaped?(e[0]+=s,s.callbacks&&(e.callbacks||(e.callbacks=[]),e.callbacks.push(...s.callbacks))):le(s,e)}},Er=class extends D{toStringToBuffer(e){Qe(this.children,e)}},lt=!1,Ve=(e,t,r)=>{if(!lt){for(const s in nt)ze[s][Ot]=nt[s];lt=!0}return typeof e=="function"?new Be(e,t,r):ze[e]?new Be(ze[e],t,r):e==="svg"||e==="head"?(xe||(xe=or("")),new D(e,t,[new Be(xe,{value:e},r)])):new D(e,t,r)};function O(e,t,r){let s;if(!t||!("children"in t))s=Ve(e,t,[]);else{const i=t.children;s=Array.isArray(i)?Ve(e,t,i):Ve(e,t,[i])}return s.key=r,s}var ut=(e,t,r)=>(s,i)=>{let n=-1;return a(0);async function a(o){if(o<=n)throw new Error("next() called multiple times");n=o;let c,u=!1,d;if(e[o]?(d=e[o][0][0],s.req.routeIndex=o):d=o===e.length&&i||void 0,d)try{c=await d(s,()=>a(o+1))}catch(h){if(h instanceof Error&&t)s.error=h,c=await t(h,s),u=!0;else throw h}else s.finalized===!1&&r&&(c=await r(s));return c&&(s.finalized===!1||u)&&(s.res=c),s}},br=Symbol(),Pr=async(e,t=Object.create(null))=>{const{all:r=!1,dot:s=!1}=t,n=(e instanceof Dt?e.raw.headers:e.headers).get("Content-Type");return n!=null&&n.startsWith("multipart/form-data")||n!=null&&n.startsWith("application/x-www-form-urlencoded")?Or(e,{all:r,dot:s}):{}};async function Or(e,t){const r=await e.formData();return r?qr(r,t):{}}function qr(e,t){const r=Object.create(null);return e.forEach((s,i)=>{t.all||i.endsWith("[]")?Rr(r,i,s):r[i]=s}),t.dot&&Object.entries(r).forEach(([s,i])=>{s.includes(".")&&(Ar(r,s,i),delete r[s])}),r}var Rr=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},Ar=(e,t,r)=>{let s=e;const i=t.split(".");i.forEach((n,a)=>{a===i.length-1?s[n]=r:((!s[n]||typeof s[n]!="object"||Array.isArray(s[n])||s[n]instanceof File)&&(s[n]=Object.create(null)),s=s[n])})},At=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},Sr=e=>{const{groups:t,path:r}=Ir(e),s=At(r);return Nr(s,t)},Ir=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{const i=`@${s}`;return t.push([i,r]),i}),{groups:t,path:e}},Nr=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[s]=t[r];for(let i=e.length-1;i>=0;i--)if(e[i].includes(s)){e[i]=e[i].replace(s,t[r][1]);break}}return e},Ae={},Tr=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${e}#${t}`;return Ae[s]||(r[2]?Ae[s]=t&&t[0]!==":"&&t[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:Ae[s]=[e,r[1],!0]),Ae[s]}return null},et=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},Dr=e=>et(e,decodeURI),St=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let s=r;for(;s<t.length;s++){const i=t.charCodeAt(s);if(i===37){const n=t.indexOf("?",s),a=t.slice(r,n===-1?void 0:n);return Dr(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(i===63)break}return t.slice(r,s)},_r=e=>{const t=St(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},ae=(e,t,...r)=>(r.length&&(t=ae(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),It=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let s="";return t.forEach(i=>{if(i!==""&&!/\:/.test(i))s+="/"+i;else if(/\:/.test(i))if(/\?/.test(i)){r.length===0&&s===""?r.push("/"):r.push(s);const n=i.replace("?","");s+="/"+n,r.push(s)}else s+="/"+i}),r.filter((i,n,a)=>a.indexOf(i)===n)},Ue=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?et(e,Tt):e):e,Nt=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf("?",8);if(a===-1)return;for(e.startsWith(t,a+1)||(a=e.indexOf(`&${t}`,a+1));a!==-1;){const o=e.charCodeAt(a+t.length+1);if(o===61){const c=a+t.length+2,u=e.indexOf("&",c);return Ue(e.slice(c,u===-1?void 0:u))}else if(o==38||isNaN(o))return"";a=e.indexOf(`&${t}`,a+1)}if(s=/[%+]/.test(e),!s)return}const i={};s??(s=/[%+]/.test(e));let n=e.indexOf("?",8);for(;n!==-1;){const a=e.indexOf("&",n+1);let o=e.indexOf("=",n);o>a&&a!==-1&&(o=-1);let c=e.slice(n+1,o===-1?a===-1?void 0:a:o);if(s&&(c=Ue(c)),n=a,c==="")continue;let u;o===-1?u="":(u=e.slice(o+1,a===-1?void 0:a),s&&(u=Ue(u))),r?(i[c]&&Array.isArray(i[c])||(i[c]=[]),i[c].push(u)):i[c]??(i[c]=u)}return t?i[t]:i},kr=Nt,Mr=(e,t)=>Nt(e,t,!0),Tt=decodeURIComponent,dt=e=>et(e,Tt),ue,S,F,_t,kt,Je,W,mt,Dt=(mt=class{constructor(e,t="/",r=[[]]){g(this,F);p(this,"raw");g(this,ue);g(this,S);p(this,"routeIndex",0);p(this,"path");p(this,"bodyCache",{});g(this,W,e=>{const{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;const i=Object.keys(t)[0];return i?t[i].then(n=>(i==="json"&&(n=JSON.stringify(n)),new Response(n)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,f(this,S,r),f(this,ue,{})}param(e){return e?y(this,F,_t).call(this,e):y(this,F,kt).call(this)}query(e){return kr(this.url,e)}queries(e){return Mr(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await Pr(this,e))}json(){return l(this,W).call(this,"text").then(e=>JSON.parse(e))}text(){return l(this,W).call(this,"text")}arrayBuffer(){return l(this,W).call(this,"arrayBuffer")}blob(){return l(this,W).call(this,"blob")}formData(){return l(this,W).call(this,"formData")}addValidatedData(e,t){l(this,ue)[e]=t}valid(e){return l(this,ue)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[br](){return l(this,S)}get matchedRoutes(){return l(this,S)[0].map(([[,e]])=>e)}get routePath(){return l(this,S)[0].map(([[,e]])=>e)[this.routeIndex].path}},ue=new WeakMap,S=new WeakMap,F=new WeakSet,_t=function(e){const t=l(this,S)[0][this.routeIndex][1][e],r=y(this,F,Je).call(this,t);return r&&/\%/.test(r)?dt(r):r},kt=function(){const e={},t=Object.keys(l(this,S)[0][this.routeIndex][1]);for(const r of t){const s=y(this,F,Je).call(this,l(this,S)[0][this.routeIndex][1][r]);s!==void 0&&(e[r]=/\%/.test(s)?dt(s):s)}return e},Je=function(e){return l(this,S)[1]?l(this,S)[1][e]:e},W=new WeakMap,mt),Hr="text/plain; charset=UTF-8",Ge=(e,t)=>({"Content-Type":e,...t}),je,we,M,de,H,A,Ee,he,pe,Y,be,Pe,z,oe,gt,$r=(gt=class{constructor(e,t){g(this,z);g(this,je);g(this,we);p(this,"env",{});g(this,M);p(this,"finalized",!1);p(this,"error");g(this,de);g(this,H);g(this,A);g(this,Ee);g(this,he);g(this,pe);g(this,Y);g(this,be);g(this,Pe);p(this,"render",(...e)=>(l(this,he)??f(this,he,t=>this.html(t)),l(this,he).call(this,...e)));p(this,"setLayout",e=>f(this,Ee,e));p(this,"getLayout",()=>l(this,Ee));p(this,"setRenderer",e=>{f(this,he,e)});p(this,"header",(e,t,r)=>{this.finalized&&f(this,A,new Response(l(this,A).body,l(this,A)));const s=l(this,A)?l(this,A).headers:l(this,Y)??f(this,Y,new Headers);t===void 0?s.delete(e):r!=null&&r.append?s.append(e,t):s.set(e,t)});p(this,"status",e=>{f(this,de,e)});p(this,"set",(e,t)=>{l(this,M)??f(this,M,new Map),l(this,M).set(e,t)});p(this,"get",e=>l(this,M)?l(this,M).get(e):void 0);p(this,"newResponse",(...e)=>y(this,z,oe).call(this,...e));p(this,"body",(e,t,r)=>y(this,z,oe).call(this,e,t,r));p(this,"text",(e,t,r)=>!l(this,Y)&&!l(this,de)&&!t&&!r&&!this.finalized?new Response(e):y(this,z,oe).call(this,e,t,Ge(Hr,r)));p(this,"json",(e,t,r)=>y(this,z,oe).call(this,JSON.stringify(e),t,Ge("application/json",r)));p(this,"html",(e,t,r)=>{const s=i=>y(this,z,oe).call(this,i,t,Ge("text/html; charset=UTF-8",r));return typeof e=="object"?Pt(e,bt.Stringify,!1,{}).then(s):s(e)});p(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});p(this,"notFound",()=>(l(this,pe)??f(this,pe,()=>new Response),l(this,pe).call(this,this)));f(this,je,e),t&&(f(this,H,t.executionCtx),this.env=t.env,f(this,pe,t.notFoundHandler),f(this,Pe,t.path),f(this,be,t.matchResult))}get req(){return l(this,we)??f(this,we,new Dt(l(this,je),l(this,Pe),l(this,be))),l(this,we)}get event(){if(l(this,H)&&"respondWith"in l(this,H))return l(this,H);throw Error("This context has no FetchEvent")}get executionCtx(){if(l(this,H))return l(this,H);throw Error("This context has no ExecutionContext")}get res(){return l(this,A)||f(this,A,new Response(null,{headers:l(this,Y)??f(this,Y,new Headers)}))}set res(e){if(l(this,A)&&e){e=new Response(e.body,e);for(const[t,r]of l(this,A).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const s=l(this,A).headers.getSetCookie();e.headers.delete("set-cookie");for(const i of s)e.headers.append("set-cookie",i)}else e.headers.set(t,r)}f(this,A,e),this.finalized=!0}get var(){return l(this,M)?Object.fromEntries(l(this,M)):{}}},je=new WeakMap,we=new WeakMap,M=new WeakMap,de=new WeakMap,H=new WeakMap,A=new WeakMap,Ee=new WeakMap,he=new WeakMap,pe=new WeakMap,Y=new WeakMap,be=new WeakMap,Pe=new WeakMap,z=new WeakSet,oe=function(e,t,r){const s=l(this,A)?new Headers(l(this,A).headers):l(this,Y)??new Headers;if(typeof t=="object"&&"headers"in t){const n=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[a,o]of n)a.toLowerCase()==="set-cookie"?s.append(a,o):s.set(a,o)}if(r)for(const[n,a]of Object.entries(r))if(typeof a=="string")s.set(n,a);else{s.delete(n);for(const o of a)s.append(n,o)}const i=typeof t=="number"?t:(t==null?void 0:t.status)??l(this,de);return new Response(e,{status:i,headers:s})},gt),w="ALL",Lr="all",Fr=["get","post","put","delete","options","patch"],Mt="Can not add a route since the matcher is already built.",Ht=class extends Error{},Kr="__COMPOSED_HANDLER",Wr=e=>e.text("404 Not Found",404),ht=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},I,E,Lt,N,J,Se,Ie,vt,$t=(vt=class{constructor(t={}){g(this,E);p(this,"get");p(this,"post");p(this,"put");p(this,"delete");p(this,"options");p(this,"patch");p(this,"all");p(this,"on");p(this,"use");p(this,"router");p(this,"getPath");p(this,"_basePath","/");g(this,I,"/");p(this,"routes",[]);g(this,N,Wr);p(this,"errorHandler",ht);p(this,"onError",t=>(this.errorHandler=t,this));p(this,"notFound",t=>(f(this,N,t),this));p(this,"fetch",(t,...r)=>y(this,E,Ie).call(this,t,r[1],r[0],t.method));p(this,"request",(t,r,s,i)=>t instanceof Request?this.fetch(r?new Request(t,r):t,s,i):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${ae("/",t)}`,r),s,i)));p(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(y(this,E,Ie).call(this,t.request,t,void 0,t.request.method))})});[...Fr,Lr].forEach(n=>{this[n]=(a,...o)=>(typeof a=="string"?f(this,I,a):y(this,E,J).call(this,n,l(this,I),a),o.forEach(c=>{y(this,E,J).call(this,n,l(this,I),c)}),this)}),this.on=(n,a,...o)=>{for(const c of[a].flat()){f(this,I,c);for(const u of[n].flat())o.map(d=>{y(this,E,J).call(this,u.toUpperCase(),l(this,I),d)})}return this},this.use=(n,...a)=>(typeof n=="string"?f(this,I,n):(f(this,I,"*"),a.unshift(n)),a.forEach(o=>{y(this,E,J).call(this,w,l(this,I),o)}),this);const{strict:s,...i}=t;Object.assign(this,i),this.getPath=s??!0?t.getPath??St:_r}route(t,r){const s=this.basePath(t);return r.routes.map(i=>{var a;let n;r.errorHandler===ht?n=i.handler:(n=async(o,c)=>(await ut([],r.errorHandler)(o,()=>i.handler(o,c))).res,n[Kr]=i.handler),y(a=s,E,J).call(a,i.method,i.path,n)}),this}basePath(t){const r=y(this,E,Lt).call(this);return r._basePath=ae(this._basePath,t),r}mount(t,r,s){let i,n;s&&(typeof s=="function"?n=s:(n=s.optionHandler,s.replaceRequest===!1?i=c=>c:i=s.replaceRequest));const a=n?c=>{const u=n(c);return Array.isArray(u)?u:[u]}:c=>{let u;try{u=c.executionCtx}catch{}return[c.env,u]};i||(i=(()=>{const c=ae(this._basePath,t),u=c==="/"?0:c.length;return d=>{const h=new URL(d.url);return h.pathname=h.pathname.slice(u)||"/",new Request(h,d)}})());const o=async(c,u)=>{const d=await r(i(c.req.raw),...a(c));if(d)return d;await u()};return y(this,E,J).call(this,w,ae(t,"*"),o),this}},I=new WeakMap,E=new WeakSet,Lt=function(){const t=new $t({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,f(t,N,l(this,N)),t.routes=this.routes,t},N=new WeakMap,J=function(t,r,s){t=t.toUpperCase(),r=ae(this._basePath,r);const i={basePath:this._basePath,path:r,method:t,handler:s};this.router.add(t,r,[s,i]),this.routes.push(i)},Se=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},Ie=function(t,r,s,i){if(i==="HEAD")return(async()=>new Response(null,await y(this,E,Ie).call(this,t,r,s,"GET")))();const n=this.getPath(t,{env:s}),a=this.router.match(i,n),o=new $r(t,{path:n,matchResult:a,env:s,executionCtx:r,notFoundHandler:l(this,N)});if(a[0].length===1){let u;try{u=a[0][0][0][0](o,async()=>{o.res=await l(this,N).call(this,o)})}catch(d){return y(this,E,Se).call(this,d,o)}return u instanceof Promise?u.then(d=>d||(o.finalized?o.res:l(this,N).call(this,o))).catch(d=>y(this,E,Se).call(this,d,o)):u??l(this,N).call(this,o)}const c=ut(a[0],this.errorHandler,l(this,N));return(async()=>{try{const u=await c(o);if(!u.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return u.res}catch(u){return y(this,E,Se).call(this,u,o)}})()},vt),Ft=[];function zr(e,t){const r=this.buildAllMatchers(),s=(i,n)=>{const a=r[i]||r[w],o=a[2][n];if(o)return o;const c=n.match(a[0]);if(!c)return[[],Ft];const u=c.indexOf("",1);return[a[1][u],c]};return this.match=s,s(e,t)}var De="[^/]+",ye=".*",Ce="(?:|/.*)",ce=Symbol(),Br=new Set(".\\+*[^]$()");function Vr(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===ye||e===Ce?1:t===ye||t===Ce?-1:e===De?1:t===De?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var Q,ee,T,yt,Ze=(yt=class{constructor(){g(this,Q);g(this,ee);g(this,T,Object.create(null))}insert(t,r,s,i,n){if(t.length===0){if(l(this,Q)!==void 0)throw ce;if(n)return;f(this,Q,r);return}const[a,...o]=t,c=a==="*"?o.length===0?["","",ye]:["","",De]:a==="/*"?["","",Ce]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let u;if(c){const d=c[1];let h=c[2]||De;if(d&&c[2]&&(h===".*"||(h=h.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(h))))throw ce;if(u=l(this,T)[h],!u){if(Object.keys(l(this,T)).some(m=>m!==ye&&m!==Ce))throw ce;if(n)return;u=l(this,T)[h]=new Ze,d!==""&&f(u,ee,i.varIndex++)}!n&&d!==""&&s.push([d,l(u,ee)])}else if(u=l(this,T)[a],!u){if(Object.keys(l(this,T)).some(d=>d.length>1&&d!==ye&&d!==Ce))throw ce;if(n)return;u=l(this,T)[a]=new Ze}u.insert(o,r,s,i,n)}buildRegExpStr(){const r=Object.keys(l(this,T)).sort(Vr).map(s=>{const i=l(this,T)[s];return(typeof l(i,ee)=="number"?`(${s})@${l(i,ee)}`:Br.has(s)?`\\${s}`:s)+i.buildRegExpStr()});return typeof l(this,Q)=="number"&&r.unshift(`#${l(this,Q)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},Q=new WeakMap,ee=new WeakMap,T=new WeakMap,yt),_e,Oe,Ct,Ur=(Ct=class{constructor(){g(this,_e,{varIndex:0});g(this,Oe,new Ze)}insert(e,t,r){const s=[],i=[];for(let a=0;;){let o=!1;if(e=e.replace(/\{[^}]+\}/g,c=>{const u=`@\\${a}`;return i[a]=[u,c],a++,o=!0,u}),!o)break}const n=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=i.length-1;a>=0;a--){const[o]=i[a];for(let c=n.length-1;c>=0;c--)if(n[c].indexOf(o)!==-1){n[c]=n[c].replace(o,i[a][1]);break}}return l(this,Oe).insert(n,t,s,l(this,_e),r),s}buildRegExp(){let e=l(this,Oe).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(i,n,a)=>n!==void 0?(r[++t]=Number(n),"$()"):(a!==void 0&&(s[Number(a)]=++t),"")),[new RegExp(`^${e}`),r,s]}},_e=new WeakMap,Oe=new WeakMap,Ct),Gr=[/^$/,[],Object.create(null)],Ne=Object.create(null);function Kt(e){return Ne[e]??(Ne[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Xr(){Ne=Object.create(null)}function Jr(e){var u;const t=new Ur,r=[];if(e.length===0)return Gr;const s=e.map(d=>[!/\*|\/:/.test(d[0]),...d]).sort(([d,h],[m,C])=>d?1:m?-1:h.length-C.length),i=Object.create(null);for(let d=0,h=-1,m=s.length;d<m;d++){const[C,b,x]=s[d];C?i[b]=[x.map(([R])=>[R,Object.create(null)]),Ft]:h++;let j;try{j=t.insert(b,h,C)}catch(R){throw R===ce?new Ht(b):R}C||(r[h]=x.map(([R,ie])=>{const me=Object.create(null);for(ie-=1;ie>=0;ie--){const[_,Fe]=j[ie];me[_]=Fe}return[R,me]}))}const[n,a,o]=t.buildRegExp();for(let d=0,h=r.length;d<h;d++)for(let m=0,C=r[d].length;m<C;m++){const b=(u=r[d][m])==null?void 0:u[1];if(!b)continue;const x=Object.keys(b);for(let j=0,R=x.length;j<R;j++)b[x[j]]=o[b[x[j]]]}const c=[];for(const d in a)c[d]=r[a[d]];return[n,c,i]}function ne(e,t){if(e){for(const r of Object.keys(e).sort((s,i)=>i.length-s.length))if(Kt(r).test(t))return[...e[r]]}}var B,V,ke,Wt,xt,Zr=(xt=class{constructor(){g(this,ke);p(this,"name","RegExpRouter");g(this,B);g(this,V);p(this,"match",zr);f(this,B,{[w]:Object.create(null)}),f(this,V,{[w]:Object.create(null)})}add(e,t,r){var o;const s=l(this,B),i=l(this,V);if(!s||!i)throw new Error(Mt);s[e]||[s,i].forEach(c=>{c[e]=Object.create(null),Object.keys(c[w]).forEach(u=>{c[e][u]=[...c[w][u]]})}),t==="/*"&&(t="*");const n=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const c=Kt(t);e===w?Object.keys(s).forEach(u=>{var d;(d=s[u])[t]||(d[t]=ne(s[u],t)||ne(s[w],t)||[])}):(o=s[e])[t]||(o[t]=ne(s[e],t)||ne(s[w],t)||[]),Object.keys(s).forEach(u=>{(e===w||e===u)&&Object.keys(s[u]).forEach(d=>{c.test(d)&&s[u][d].push([r,n])})}),Object.keys(i).forEach(u=>{(e===w||e===u)&&Object.keys(i[u]).forEach(d=>c.test(d)&&i[u][d].push([r,n]))});return}const a=It(t)||[t];for(let c=0,u=a.length;c<u;c++){const d=a[c];Object.keys(i).forEach(h=>{var m;(e===w||e===h)&&((m=i[h])[d]||(m[d]=[...ne(s[h],d)||ne(s[w],d)||[]]),i[h][d].push([r,n-u+c+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(l(this,V)).concat(Object.keys(l(this,B))).forEach(t=>{e[t]||(e[t]=y(this,ke,Wt).call(this,t))}),f(this,B,f(this,V,void 0)),Xr(),e}},B=new WeakMap,V=new WeakMap,ke=new WeakSet,Wt=function(e){const t=[];let r=e===w;return[l(this,B),l(this,V)].forEach(s=>{const i=s[e]?Object.keys(s[e]).map(n=>[n,s[e][n]]):[];i.length!==0?(r||(r=!0),t.push(...i)):e!==w&&t.push(...Object.keys(s[w]).map(n=>[n,s[w][n]]))}),r?Jr(t):null},xt),U,$,jt,Yr=(jt=class{constructor(e){p(this,"name","SmartRouter");g(this,U,[]);g(this,$,[]);f(this,U,e.routers)}add(e,t,r){if(!l(this,$))throw new Error(Mt);l(this,$).push([e,t,r])}match(e,t){if(!l(this,$))throw new Error("Fatal error");const r=l(this,U),s=l(this,$),i=r.length;let n=0,a;for(;n<i;n++){const o=r[n];try{for(let c=0,u=s.length;c<u;c++)o.add(...s[c]);a=o.match(e,t)}catch(c){if(c instanceof Ht)continue;throw c}this.match=o.match.bind(o),f(this,U,[o]),f(this,$,void 0);break}if(n===i)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(l(this,$)||l(this,U).length!==1)throw new Error("No active router has been determined yet.");return l(this,U)[0]}},U=new WeakMap,$=new WeakMap,jt),ve=Object.create(null),G,q,te,fe,P,L,Z,wt,zt=(wt=class{constructor(e,t,r){g(this,L);g(this,G);g(this,q);g(this,te);g(this,fe,0);g(this,P,ve);if(f(this,q,r||Object.create(null)),f(this,G,[]),e&&t){const s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},f(this,G,[s])}f(this,te,[])}insert(e,t,r){f(this,fe,++st(this,fe)._);let s=this;const i=Sr(t),n=[];for(let a=0,o=i.length;a<o;a++){const c=i[a],u=i[a+1],d=Tr(c,u),h=Array.isArray(d)?d[0]:c;if(h in l(s,q)){s=l(s,q)[h],d&&n.push(d[1]);continue}l(s,q)[h]=new zt,d&&(l(s,te).push(d),n.push(d[1])),s=l(s,q)[h]}return l(s,G).push({[e]:{handler:r,possibleKeys:n.filter((a,o,c)=>c.indexOf(a)===o),score:l(this,fe)}}),s}search(e,t){var o;const r=[];f(this,P,ve);let i=[this];const n=At(t),a=[];for(let c=0,u=n.length;c<u;c++){const d=n[c],h=c===u-1,m=[];for(let C=0,b=i.length;C<b;C++){const x=i[C],j=l(x,q)[d];j&&(f(j,P,l(x,P)),h?(l(j,q)["*"]&&r.push(...y(this,L,Z).call(this,l(j,q)["*"],e,l(x,P))),r.push(...y(this,L,Z).call(this,j,e,l(x,P)))):m.push(j));for(let R=0,ie=l(x,te).length;R<ie;R++){const me=l(x,te)[R],_=l(x,P)===ve?{}:{...l(x,P)};if(me==="*"){const K=l(x,q)["*"];K&&(r.push(...y(this,L,Z).call(this,K,e,l(x,P))),f(K,P,_),m.push(K));continue}const[Fe,tt,ge]=me;if(!d&&!(ge instanceof RegExp))continue;const k=l(x,q)[Fe],Yt=n.slice(c).join("/");if(ge instanceof RegExp){const K=ge.exec(Yt);if(K){if(_[tt]=K[0],r.push(...y(this,L,Z).call(this,k,e,l(x,P),_)),Object.keys(l(k,q)).length){f(k,P,_);const Ke=((o=K[0].match(/\//))==null?void 0:o.length)??0;(a[Ke]||(a[Ke]=[])).push(k)}continue}}(ge===!0||ge.test(d))&&(_[tt]=d,h?(r.push(...y(this,L,Z).call(this,k,e,_,l(x,P))),l(k,q)["*"]&&r.push(...y(this,L,Z).call(this,l(k,q)["*"],e,_,l(x,P)))):(f(k,P,_),m.push(k)))}}i=m.concat(a.shift()??[])}return r.length>1&&r.sort((c,u)=>c.score-u.score),[r.map(({handler:c,params:u})=>[c,u])]}},G=new WeakMap,q=new WeakMap,te=new WeakMap,fe=new WeakMap,P=new WeakMap,L=new WeakSet,Z=function(e,t,r,s){const i=[];for(let n=0,a=l(e,G).length;n<a;n++){const o=l(e,G)[n],c=o[t]||o[w],u={};if(c!==void 0&&(c.params=Object.create(null),i.push(c),r!==ve||s&&s!==ve))for(let d=0,h=c.possibleKeys.length;d<h;d++){const m=c.possibleKeys[d],C=u[c.score];c.params[m]=s!=null&&s[m]&&!C?s[m]:r[m]??(s==null?void 0:s[m]),u[c.score]=!0}}return i},wt),re,Et,Qr=(Et=class{constructor(){p(this,"name","TrieRouter");g(this,re);f(this,re,new zt)}add(e,t,r){const s=It(t);if(s){for(let i=0,n=s.length;i<n;i++)l(this,re).insert(e,s[i],r);return}l(this,re).insert(e,t,r)}match(e,t){return l(this,re).search(e,t)}},re=new WeakMap,Et),Bt=class extends $t{constructor(e={}){super(e),this.router=e.router??new Yr({routers:[new Zr,new Qr]})}},es=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},s=(n=>typeof n=="string"?n==="*"?()=>n:a=>n===a?a:null:typeof n=="function"?n:a=>n.includes(a)?a:null)(r.origin),i=(n=>typeof n=="function"?n:Array.isArray(n)?()=>n:()=>[])(r.allowMethods);return async function(a,o){var d;function c(h,m){a.res.headers.set(h,m)}const u=await s(a.req.header("origin")||"",a);if(u&&c("Access-Control-Allow-Origin",u),r.credentials&&c("Access-Control-Allow-Credentials","true"),(d=r.exposeHeaders)!=null&&d.length&&c("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),a.req.method==="OPTIONS"){r.origin!=="*"&&c("Vary","Origin"),r.maxAge!=null&&c("Access-Control-Max-Age",r.maxAge.toString());const h=await i(a.req.header("origin")||"",a);h.length&&c("Access-Control-Allow-Methods",h.join(","));let m=r.allowHeaders;if(!(m!=null&&m.length)){const C=a.req.header("Access-Control-Request-Headers");C&&(m=C.split(/\s*,\s*/))}return m!=null&&m.length&&(c("Access-Control-Allow-Headers",m.join(",")),a.res.headers.append("Vary","Access-Control-Request-Headers")),a.res.headers.delete("Content-Length"),a.res.headers.delete("Content-Type"),new Response(null,{headers:a.res.headers,status:204,statusText:"No Content"})}await o(),r.origin!=="*"&&a.header("Vary","Origin",{append:!0})}},ts=/^\s*(?:text\/(?!event-stream(?:[;\s]|$))[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,pt=(e,t=ss)=>{const r=/\.([a-zA-Z0-9]+?)$/,s=e.match(r);if(!s)return;let i=t[s[1]];return i&&i.startsWith("text")&&(i+="; charset=utf-8"),i},rs={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},ss=rs,is=(...e)=>{let t=e.filter(i=>i!=="").join("/");t=t.replace(new RegExp("(?<=\\/)\\/+","g"),"");const r=t.split("/"),s=[];for(const i of r)i===".."&&s.length>0&&s.at(-1)!==".."?s.pop():i!=="."&&s.push(i);return s.join("/")||"."},Vt={br:".br",zstd:".zst",gzip:".gz"},ns=Object.keys(Vt),as="index.html",os=e=>{const t=e.root??"./",r=e.path,s=e.join??is;return async(i,n)=>{var d,h,m,C;if(i.finalized)return n();let a;if(e.path)a=e.path;else try{if(a=decodeURIComponent(i.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(a))throw new Error}catch{return await((d=e.onNotFound)==null?void 0:d.call(e,i.req.path,i)),n()}let o=s(t,!r&&e.rewriteRequestPath?e.rewriteRequestPath(a):a);e.isDir&&await e.isDir(o)&&(o=s(o,as));const c=e.getContent;let u=await c(o,i);if(u instanceof Response)return i.newResponse(u.body,u);if(u){const b=e.mimes&&pt(o,e.mimes)||pt(o);if(i.header("Content-Type",b||"application/octet-stream"),e.precompressed&&(!b||ts.test(b))){const x=new Set((h=i.req.header("Accept-Encoding"))==null?void 0:h.split(",").map(j=>j.trim()));for(const j of ns){if(!x.has(j))continue;const R=await c(o+Vt[j],i);if(R){u=R,i.header("Content-Encoding",j),i.header("Vary","Accept-Encoding",{append:!0});break}}}return await((m=e.onFound)==null?void 0:m.call(e,o,i)),i.body(u)}await((C=e.onNotFound)==null?void 0:C.call(e,o,i)),await n()}},cs=async(e,t)=>{let r;t&&t.manifest?typeof t.manifest=="string"?r=JSON.parse(t.manifest):r=t.manifest:typeof __STATIC_CONTENT_MANIFEST=="string"?r=JSON.parse(__STATIC_CONTENT_MANIFEST):r=__STATIC_CONTENT_MANIFEST;let s;t&&t.namespace?s=t.namespace:s=__STATIC_CONTENT;const i=r[e]||e;if(!i)return null;const n=await s.get(i,{type:"stream"});return n||null},ls=e=>async function(r,s){return os({...e,getContent:async n=>cs(n,{manifest:e.manifest,namespace:e.namespace?e.namespace:r.env?r.env.__STATIC_CONTENT:void 0})})(r,s)},us=e=>ls(e);const v=new Bt;v.use("/api/*",es());v.use("/static/*",us({root:"./"}));const se=[{id:1,name:"HOWO 165",plate:"А123ВС",type:"Самосвал",driver:"Иванов И.И.",driverId:1,fuelLevel:75,status:"active",mileage:125e3,lastService:124500,nextService:13e4,location:"Объект №5",latitude:42.8746,longitude:74.5698,photos:["/static/images/howo.jpg","/static/images/howo2.jpg"],techPassportPhotos:["/static/images/techpassport1-front.jpg","/static/images/techpassport1-back.jpg"],maintenanceCostPerMonth:25e3,fuelConsumptionPerKm:.35,avgKmPerMonth:3e3,purchaseDate:"2020-03-15",vin:"LZYTBSMK8FA123456"},{id:2,name:"Камаз 6520",plate:"В456СЕ",type:"Самосвал",driver:"Петров П.П.",driverId:2,fuelLevel:45,status:"active",mileage:98e3,lastService:95e3,nextService:105e3,location:"Объект №3",latitude:42.865,longitude:74.59,photos:["/static/images/kamaz.jpg"],techPassportPhotos:["/static/images/techpassport2-front.jpg","/static/images/techpassport2-back.jpg"],maintenanceCostPerMonth:22e3,fuelConsumptionPerKm:.3,avgKmPerMonth:2500,purchaseDate:"2018-06-20",vin:"X5КАМАЗ65206789012"},{id:3,name:"Caterpillar 320",plate:"Е789КМ",type:"Экскаватор",driver:"Сидоров С.С.",driverId:3,fuelLevel:20,status:"warning",mileage:5600,lastService:5e3,nextService:6e3,location:"Объект №1",latitude:42.882,longitude:74.61,photos:["/static/images/cat.jpg"],techPassportPhotos:["/static/images/techpassport3-front.jpg","/static/images/techpassport3-back.jpg"],maintenanceCostPerMonth:3e4,fuelConsumptionPerKm:.4,avgKmPerMonth:800,purchaseDate:"2019-08-10",vin:"CAT320D2KLM456789"}],Ut=[{id:1,name:"Иванов И.И.",phone:"+996 555 111222",telegram:"@ivanov_driver",experience:"7 лет",license:"CE",birthDate:"1985-05-15",passportSeries:"AN",passportNumber:"1234567",passportIssueDate:"2015-06-20",passportIssuer:"МВД КР",photo:"/static/images/driver1.jpg",passportPhoto:"/static/images/passport1.jpg",licensePhoto:"/static/images/license1.jpg",address:"г. Бишкек, ул. Ленина 123",status:"active",hireDate:"2020-03-15",currentVehicle:"HOWO 165 (А123ВС)"},{id:2,name:"Петров П.П.",phone:"+996 777 333444",telegram:"@petrov_driver",experience:"10 лет",license:"CE",birthDate:"1980-08-22",passportSeries:"AN",passportNumber:"7654321",passportIssueDate:"2010-04-15",passportIssuer:"МВД КР",photo:"/static/images/driver2.jpg",passportPhoto:"/static/images/passport2.jpg",licensePhoto:"/static/images/license2.jpg",address:"г. Бишкек, ул. Советская 45",status:"active",hireDate:"2018-06-01",currentVehicle:"Камаз 6520 (В456СЕ)"},{id:3,name:"Сидоров С.С.",phone:"+996 555 999888",telegram:"@sidorov_driver",experience:"12 лет",license:"D",birthDate:"1978-12-10",passportSeries:"AN",passportNumber:"9876543",passportIssueDate:"2008-09-25",passportIssuer:"МВД КР",photo:"/static/images/driver3.jpg",passportPhoto:"/static/images/passport3.jpg",licensePhoto:"/static/images/license3.jpg",address:"г. Бишкек, пр. Манаса 78",status:"active",hireDate:"2017-01-20",currentVehicle:"Caterpillar 320 (Е789КМ)"}],$e=[{id:1,vehicleId:1,vehicleName:"HOWO 165",vehiclePlate:"А123ВС",driver:"Иванов И.И.",liters:250,amount:18750,date:"2025-11-27 08:30",location:"АЗС №5",latitude:42.8746,longitude:74.5698,photo:"/static/images/fueling1.jpg"},{id:2,vehicleId:2,vehicleName:"Камаз 6520",vehiclePlate:"В456СЕ",driver:"Петров П.П.",liters:180,amount:13500,date:"2025-11-27 10:15",location:"АЗС №3",latitude:42.865,longitude:74.59,photo:"/static/images/fueling2.jpg"},{id:3,vehicleId:1,vehicleName:"HOWO 165",vehiclePlate:"А123ВС",driver:"Иванов И.И.",liters:230,amount:17250,date:"2025-11-25 14:20",location:"АЗС №5",latitude:42.8746,longitude:74.5698,photo:"/static/images/fueling1.jpg"},{id:4,vehicleId:3,vehicleName:"Caterpillar 320",vehiclePlate:"Е789КМ",driver:"Сидоров С.С.",liters:150,amount:11250,date:"2025-11-24 09:45",location:"АЗС №1",latitude:42.882,longitude:74.61,photo:"/static/images/fueling3.jpg"}],Le=[{id:1,vehicleId:1,vehicleName:"HOWO 165",vehiclePlate:"А123ВС",driver:"Иванов И.И.",description:"Первое ТО после покупки",parts:[{name:"Масло моторное",quantity:20,unit:"л",price:150,total:3e3},{name:"Фильтр масляный",quantity:1,unit:"шт",price:800,total:800},{name:"Фильтр воздушный",quantity:1,unit:"шт",price:700,total:700}],partsCost:4500,laborCost:2e3,totalCost:6500,date:"2020-06-15",photos:["/static/images/repair1.jpg"],status:"completed",mechanic:"Сергеев М.М."},{id:2,vehicleId:1,vehicleName:"HOWO 165",vehiclePlate:"А123ВС",driver:"Иванов И.И.",description:"Замена передних тормозных колодок",parts:[{name:"Колодки тормозные передние",quantity:1,unit:"компл",price:4500,total:4500},{name:"Жидкость тормозная",quantity:2,unit:"л",price:350,total:700}],partsCost:5200,laborCost:3e3,totalCost:8200,date:"2021-03-20",photos:["/static/images/repair1.jpg"],status:"completed",mechanic:"Сергеев М.М."},{id:3,vehicleId:1,vehicleName:"HOWO 165",vehiclePlate:"А123ВС",driver:"Иванов И.И.",description:"Ремонт двигателя - замена поршневой группы",parts:[{name:"Поршни комплект",quantity:1,unit:"компл",price:25e3,total:25e3},{name:"Кольца поршневые",quantity:1,unit:"компл",price:8e3,total:8e3},{name:"Прокладки двигателя",quantity:1,unit:"компл",price:3500,total:3500},{name:"Масло моторное",quantity:25,unit:"л",price:150,total:3750}],partsCost:40250,laborCost:15e3,totalCost:55250,date:"2022-08-10",photos:["/static/images/repair1.jpg","/static/images/repair2.jpg"],status:"completed",mechanic:"Сергеев М.М."},{id:4,vehicleId:1,vehicleName:"HOWO 165",vehiclePlate:"А123ВС",driver:"Иванов И.И.",description:"ТО - замена масла, фильтров и диагностика",parts:[{name:"Масло моторное",quantity:20,unit:"л",price:150,total:3e3},{name:"Фильтр масляный",quantity:1,unit:"шт",price:800,total:800},{name:"Фильтр воздушный",quantity:1,unit:"шт",price:700,total:700},{name:"Фильтр топливный",quantity:1,unit:"шт",price:1200,total:1200}],partsCost:5700,laborCost:2500,totalCost:8200,date:"2023-11-05",photos:["/static/images/repair1.jpg"],status:"completed",mechanic:"Сергеев М.М."},{id:5,vehicleId:1,vehicleName:"HOWO 165",vehiclePlate:"А123ВС",driver:"Иванов И.И.",description:"Замена рулевой рейки и сход-развал",parts:[{name:"Рулевая рейка",quantity:1,unit:"шт",price:18e3,total:18e3},{name:"Рулевые наконечники",quantity:2,unit:"шт",price:1500,total:3e3},{name:"Сайлентблоки рычагов",quantity:4,unit:"шт",price:800,total:3200}],partsCost:24200,laborCost:8e3,totalCost:32200,date:"2024-06-15",photos:["/static/images/repair1.jpg","/static/images/repair2.jpg"],status:"completed",mechanic:"Сергеев М.М."},{id:6,vehicleId:1,vehicleName:"HOWO 165",vehiclePlate:"А123ВС",driver:"Иванов И.И.",description:"Плановое ТО и замена масла",parts:[{name:"Масло моторное",quantity:20,unit:"л",price:150,total:3e3},{name:"Фильтр масляный",quantity:1,unit:"шт",price:800,total:800},{name:"Фильтр воздушный",quantity:1,unit:"шт",price:700,total:700}],partsCost:4500,laborCost:2e3,totalCost:6500,date:"2025-11-25",photos:["/static/images/repair1.jpg","/static/images/repair2.jpg"],status:"completed",mechanic:"Сергеев М.М."},{id:7,vehicleId:2,vehicleName:"Камаз 6520",vehiclePlate:"В456СЕ",driver:"Петров П.П.",description:"Первое ТО после покупки",parts:[{name:"Масло моторное",quantity:22,unit:"л",price:140,total:3080},{name:"Фильтры комплект",quantity:1,unit:"компл",price:2200,total:2200}],partsCost:5280,laborCost:2e3,totalCost:7280,date:"2018-09-20",photos:["/static/images/repair4.jpg"],status:"completed",mechanic:"Сергеев М.М."},{id:8,vehicleId:2,vehicleName:"Камаз 6520",vehiclePlate:"В456СЕ",driver:"Петров П.П.",description:"Ремонт КПП - замена сцепления",parts:[{name:"Сцепление комплект",quantity:1,unit:"компл",price:22e3,total:22e3},{name:"Выжимной подшипник",quantity:1,unit:"шт",price:3500,total:3500},{name:"Масло трансмиссионное",quantity:8,unit:"л",price:200,total:1600}],partsCost:27100,laborCost:12e3,totalCost:39100,date:"2020-04-15",photos:["/static/images/repair4.jpg"],status:"completed",mechanic:"Сергеев М.М."},{id:9,vehicleId:2,vehicleName:"Камаз 6520",vehiclePlate:"В456СЕ",driver:"Петров П.П.",description:"Капитальный ремонт двигателя",parts:[{name:"Поршневая группа",quantity:1,unit:"компл",price:35e3,total:35e3},{name:"Вкладыши коленвала",quantity:1,unit:"компл",price:8500,total:8500},{name:"Прокладки и сальники",quantity:1,unit:"компл",price:5e3,total:5e3},{name:"Масло моторное",quantity:30,unit:"л",price:140,total:4200}],partsCost:52700,laborCost:25e3,totalCost:77700,date:"2022-01-25",photos:["/static/images/repair4.jpg"],status:"completed",mechanic:"Сергеев М.М."},{id:10,vehicleId:2,vehicleName:"Камаз 6520",vehiclePlate:"В456СЕ",driver:"Петров П.П.",description:"Замена тормозных колодок",parts:[{name:"Колодки тормозные передние",quantity:1,unit:"компл",price:4200,total:4200},{name:"Жидкость тормозная",quantity:2,unit:"л",price:350,total:700}],partsCost:4900,laborCost:3e3,totalCost:7900,date:"2025-11-22",photos:["/static/images/repair4.jpg"],status:"completed",mechanic:"Сергеев М.М."},{id:11,vehicleId:3,vehicleName:"Caterpillar 320",vehiclePlate:"Е789КМ",driver:"Сидоров С.С.",description:"Первое ТО после покупки",parts:[{name:"Масло гидравлическое",quantity:150,unit:"л",price:180,total:27e3},{name:"Фильтры гидравлики комплект",quantity:1,unit:"компл",price:8500,total:8500}],partsCost:35500,laborCost:5e3,totalCost:40500,date:"2020-02-10",photos:["/static/images/repair3.jpg"],status:"completed",mechanic:"Сергеев М.М."},{id:12,vehicleId:3,vehicleName:"Caterpillar 320",vehiclePlate:"Е789КМ",driver:"Сидоров С.С.",description:"Замена гусениц",parts:[{name:"Гусеница левая",quantity:1,unit:"шт",price:12e4,total:12e4},{name:"Гусеница правая",quantity:1,unit:"шт",price:12e4,total:12e4}],partsCost:24e4,laborCost:15e3,totalCost:255e3,date:"2021-09-15",photos:["/static/images/repair3.jpg"],status:"completed",mechanic:"Сергеев М.М."},{id:13,vehicleId:3,vehicleName:"Caterpillar 320",vehiclePlate:"Е789КМ",driver:"Сидоров С.С.",description:"Ремонт гидронасоса",parts:[{name:"Гидронасос основной",quantity:1,unit:"шт",price:85e3,total:85e3},{name:"Уплотнители комплект",quantity:1,unit:"компл",price:3500,total:3500},{name:"Масло гидравлическое",quantity:20,unit:"л",price:180,total:3600}],partsCost:92100,laborCost:18e3,totalCost:110100,date:"2023-05-20",photos:["/static/images/repair3.jpg"],status:"completed",mechanic:"Сергеев М.М."},{id:14,vehicleId:3,vehicleName:"Caterpillar 320",vehiclePlate:"Е789КМ",driver:"Сидоров С.С.",description:"Ремонт гидравлики",parts:[{name:"Шланг гидравлический",quantity:2,unit:"шт",price:3500,total:7e3},{name:"Уплотнители комплект",quantity:1,unit:"компл",price:1500,total:1500}],partsCost:8500,laborCost:5e3,totalCost:13500,date:"2025-11-26",photos:["/static/images/repair3.jpg"],status:"in_progress",mechanic:"Сергеев М.М."}],ds=[{id:1,name:"Алексеев А.А.",phone:"+996 555 123456",telegram:"@alexeev_driver",experience:"5 лет",license:"CE",date:"2025-11-27 09:00",status:"pending"},{id:2,name:"Николаев Н.Н.",phone:"+996 777 654321",telegram:"@nikolaev_driver",experience:"8 лет",license:"D",date:"2025-11-26 15:30",status:"pending"}],Gt=[{id:1,vehicleType:"Самосвал",brand:"HOWO",model:"ZZ3257N3847A",quantity:2,estimatedPrice:45e5,totalCost:9e6,reason:"Расширение парка для нового объекта",requestedBy:"Начальник отдела",requestDate:"2025-11-20",status:"pending",priority:"high",expectedDelivery:"2025-12-15",notes:"Требуется для объекта №7"},{id:2,vehicleType:"Экскаватор",brand:"Caterpillar",model:"330",quantity:1,estimatedPrice:85e5,totalCost:85e5,reason:"Замена старой техники",requestedBy:"Главный инженер",requestDate:"2025-11-18",status:"approved",priority:"medium",expectedDelivery:"2025-12-30",notes:"На замену CAT 320"},{id:3,vehicleType:"Погрузчик",brand:"Liugong",model:"CLG856H",quantity:1,estimatedPrice:32e5,totalCost:32e5,reason:"Новый объект требует дополнительную технику",requestedBy:"Начальник отдела",requestDate:"2025-11-15",status:"rejected",priority:"low",expectedDelivery:"2026-01-10",notes:"Отклонено по бюджету"}],Xt=[{id:1,vehicleId:1,vehicleName:"HOWO 165",vehiclePlate:"А123ВС",partName:"Рулевая рейка",partNumber:"WG9725470200",quantity:1,unit:"шт",estimatedPrice:45e3,totalCost:45e3,supplier:'ООО "Хово Запчасти"',reason:"Требует замены, выработан ресурс",requestedBy:"Механик Сергеев М.М.",requestDate:"2025-11-26",driver:"Иванов И.И.",status:"pending",priority:"high",expectedDelivery:"2025-12-05",notes:"Срочно требуется для техники"},{id:2,vehicleId:1,vehicleName:"HOWO 165",vehiclePlate:"А123ВС",partName:"Комплект тормозных дисков",partNumber:"WG9100443001",quantity:2,unit:"компл",estimatedPrice:12e3,totalCost:24e3,supplier:'ООО "Хово Запчасти"',reason:"Плановая замена",requestedBy:"Механик Сергеев М.М.",requestDate:"2025-11-25",driver:"Иванов И.И.",status:"approved",priority:"medium",expectedDelivery:"2025-12-01",notes:"Согласовано"},{id:3,vehicleId:2,vehicleName:"Камаз 6520",vehiclePlate:"В456СЕ",partName:"Генератор 28В",partNumber:"6582.3771000",quantity:1,unit:"шт",estimatedPrice:18500,totalCost:18500,supplier:'ООО "КамАЗ Сервис"',reason:"Вышел из строя",requestedBy:"Механик Сергеев М.М.",requestDate:"2025-11-24",driver:"Петров П.П.",status:"ordered",priority:"high",expectedDelivery:"2025-11-30",notes:"Заказ размещен"},{id:4,vehicleId:3,vehicleName:"Caterpillar 320",vehiclePlate:"Е789КМ",partName:"Гидравлический насос",partNumber:"14X-49-11301",quantity:1,unit:"шт",estimatedPrice:125e3,totalCost:125e3,supplier:'ООО "CAT Parts"',reason:"Течь масла",requestedBy:"Механик Сергеев М.М.",requestDate:"2025-11-23",driver:"Сидоров С.С.",status:"pending",priority:"high",expectedDelivery:"2025-12-10",notes:"Требует срочной замены"}],hs=[{id:1,type:"fuel_low",title:"Низкий уровень топлива",message:"Caterpillar 320 (Е789КМ) - уровень топлива 20%. Требуется заправка!",vehicleId:3,priority:"high",date:"2025-11-27 11:30"},{id:2,type:"service_due",title:"Требуется замена масла",message:"HOWO 165 (А123ВС) - осталось 500 км до замены масла",vehicleId:1,priority:"medium",date:"2025-11-27 10:00"},{id:3,type:"driver_request",title:"Новая заявка водителя",message:"Алексеев А.А. подал заявку на регистрацию",priority:"medium",date:"2025-11-27 09:00"}],Jt=[{id:1,name:"Объект №1 - Жилой комплекс",description:"Строительство жилого комплекса на ул. Ахунбаева",address:"г. Бишкек, ул. Ахунбаева",status:"active",area:15e3,vehicleCount:1,vehicleIds:[3],coordinates:[[42.8815,74.609],[42.8825,74.609],[42.8825,74.611],[42.8815,74.611],[42.8815,74.609]],center:[42.882,74.61],startDate:"2025-01-10",estimatedEndDate:"2025-12-31",contractor:'ОсОО "СтройМастер"',projectManager:"Иванов А.С."},{id:2,name:"Объект №3 - Торговый центр",description:"Строительство торгового центра на проспекте Манаса",address:"г. Бишкек, пр. Манаса",status:"active",area:25e3,vehicleCount:1,vehicleIds:[2],coordinates:[[42.864,74.589],[42.866,74.589],[42.866,74.591],[42.864,74.591],[42.864,74.589]],center:[42.865,74.59],startDate:"2024-06-15",estimatedEndDate:"2026-03-20",contractor:'ОсОО "МегаСтрой"',projectManager:"Петров В.И."},{id:3,name:"Объект №5 - Дорожное строительство",description:"Реконструкция дорожного полотна на Южной магистрали",address:"г. Бишкек, Южная магистраль",status:"active",area:45e3,vehicleCount:1,vehicleIds:[1],coordinates:[[42.8736,74.5688],[42.8756,74.5688],[42.8756,74.5708],[42.8736,74.5708],[42.8736,74.5688]],center:[42.8746,74.5698],startDate:"2025-03-01",estimatedEndDate:"2025-11-30",contractor:'ОсОО "ДорСтрой"',projectManager:"Сидоров К.П."},{id:4,name:"Объект №7 - Новый район (планируется)",description:"Подготовка к строительству нового жилого района",address:"г. Бишкек, мкр. Асанбай",status:"planned",area:8e4,vehicleCount:0,vehicleIds:[],coordinates:[[42.89,74.62],[42.895,74.62],[42.895,74.628],[42.89,74.628],[42.89,74.62]],center:[42.8925,74.624],startDate:"2026-01-15",estimatedEndDate:"2028-12-31",contractor:"ТБА",projectManager:"ТБА"}];v.get("/api/vehicles",e=>e.json(se));v.get("/api/vehicles/:id",e=>{const t=parseInt(e.req.param("id")),r=se.find(s=>s.id===t);return r?e.json(r):e.json({error:"Vehicle not found"},404)});v.get("/api/fuelings",e=>e.json($e));v.get("/api/fuelings/:id",e=>{const t=parseInt(e.req.param("id")),r=$e.find(s=>s.id===t);return r?e.json(r):e.json({error:"Fueling not found"},404)});v.get("/api/repairs",e=>e.json(Le));v.get("/api/repairs/:id",e=>{const t=parseInt(e.req.param("id")),r=Le.find(s=>s.id===t);return r?e.json(r):e.json({error:"Repair not found"},404)});v.get("/api/driver-requests",e=>e.json(ds));v.post("/api/driver-requests/:id/approve",e=>(parseInt(e.req.param("id")),e.json({success:!0,message:"Водитель одобрен"})));v.post("/api/driver-requests/:id/reject",e=>(parseInt(e.req.param("id")),e.json({success:!0,message:"Заявка отклонена"})));v.get("/api/notifications",e=>e.json(hs));v.get("/api/currency",e=>e.json({som_to_usd:87.5,som_to_rub:.95,som_to_eur:94.2,updated:"2025-11-27 12:00"}));v.get("/api/drivers",e=>e.json(Ut));v.get("/api/drivers/:id",e=>{const t=parseInt(e.req.param("id")),r=Ut.find(s=>s.id===t);return r?e.json(r):e.json({error:"Driver not found"},404)});v.get("/api/vehicle-purchase-requests",e=>e.json(Gt));v.get("/api/vehicle-purchase-requests/:id",e=>{const t=parseInt(e.req.param("id")),r=Gt.find(s=>s.id===t);return r?e.json(r):e.json({error:"Request not found"},404)});v.post("/api/vehicle-purchase-requests/:id/approve",e=>(parseInt(e.req.param("id")),e.json({success:!0,message:"Заявка одобрена"})));v.post("/api/vehicle-purchase-requests/:id/reject",e=>(parseInt(e.req.param("id")),e.json({success:!0,message:"Заявка отклонена"})));v.get("/api/parts-requests",e=>e.json(Xt));v.get("/api/parts-requests/:id",e=>{const t=parseInt(e.req.param("id")),r=Xt.find(s=>s.id===t);return r?e.json(r):e.json({error:"Request not found"},404)});v.post("/api/parts-requests/:id/approve",e=>(parseInt(e.req.param("id")),e.json({success:!0,message:"Заявка одобрена"})));v.post("/api/parts-requests/:id/reject",e=>(parseInt(e.req.param("id")),e.json({success:!0,message:"Заявка отклонена"})));v.get("/api/vehicles/:id/history",e=>{const t=parseInt(e.req.param("id")),r=se.find(n=>n.id===t);if(!r)return e.json({error:"Vehicle not found"},404);const s=$e.filter(n=>n.vehicleId===t),i=Le.filter(n=>n.vehicleId===t);return e.json({vehicle:r,fuelings:s,repairs:i})});v.get("/api/vehicles/:id/expenses",e=>{const t=parseInt(e.req.param("id")),r=se.find(o=>o.id===t);if(!r)return e.json({error:"Vehicle not found"},404);const s=$e.filter(o=>o.vehicleId===t),i=Le.filter(o=>o.vehicleId===t),n={};s.forEach(o=>{const c=o.date.split(" ")[0];n[c]||(n[c]={date:c,fuel:0,fuelCost:0,oil:0,oilCost:0,parts:0,partsCost:0,labor:0,total:0,items:[]}),n[c].fuel+=o.liters,n[c].fuelCost+=o.amount,n[c].total+=o.amount,n[c].items.push({type:"fuel",description:`Заправка ${o.liters}л`,amount:o.amount})}),i.forEach(o=>{const c=o.date;n[c]||(n[c]={date:c,fuel:0,fuelCost:0,oil:0,oilCost:0,parts:0,partsCost:0,labor:0,total:0,items:[]}),Array.isArray(o.parts)&&o.parts.forEach(u=>{u.name.toLowerCase().includes("масло")?(n[c].oil+=u.quantity,n[c].oilCost+=u.total):(n[c].parts+=u.quantity,n[c].partsCost+=u.total)}),n[c].labor+=o.laborCost,n[c].total+=o.totalCost,n[c].items.push({type:"repair",description:o.description,amount:o.totalCost})});const a=Object.values(n).sort((o,c)=>new Date(c.date).getTime()-new Date(o.date).getTime());return e.json({vehicle:r,expenses:a,summary:{totalFuel:a.reduce((o,c)=>o+c.fuel,0),totalFuelCost:a.reduce((o,c)=>o+c.fuelCost,0),totalOil:a.reduce((o,c)=>o+c.oil,0),totalOilCost:a.reduce((o,c)=>o+c.oilCost,0),totalPartsCost:a.reduce((o,c)=>o+c.partsCost,0),totalLaborCost:a.reduce((o,c)=>o+c.labor,0),grandTotal:a.reduce((o,c)=>o+c.total,0)}})});v.get("/api/maintenance-forecast",e=>{const t=e.req.query("vehicleId");if(t){const a=parseInt(t),o=se.find(m=>m.id===a);if(!o)return e.json({error:"Vehicle not found"},404);const c=o.avgKmPerMonth,u=c*o.fuelConsumptionPerKm*75,d=o.maintenanceCostPerMonth,h=u+d;return e.json({vehicleId:o.id,vehicleName:o.name,vehiclePlate:o.plate,monthlyKm:c,fuelConsumption:o.fuelConsumptionPerKm,estimatedFuelCost:Math.round(u),estimatedMaintenanceCost:d,estimatedTotalCost:Math.round(h)})}const r=se.map(a=>{const o=a.avgKmPerMonth,c=o*a.fuelConsumptionPerKm*75,u=a.maintenanceCostPerMonth,d=c+u;return{vehicleId:a.id,vehicleName:a.name,vehiclePlate:a.plate,monthlyKm:o,fuelConsumption:a.fuelConsumptionPerKm,estimatedFuelCost:Math.round(c),estimatedMaintenanceCost:u,estimatedTotalCost:Math.round(d)}}),s=r.reduce((a,o)=>a+o.estimatedFuelCost,0),i=r.reduce((a,o)=>a+o.estimatedMaintenanceCost,0),n=s+i;return e.json({vehicles:r,summary:{totalFuelCost:s,totalMaintenanceCost:i,grandTotal:n}})});v.get("/api/geozones",e=>e.json(Jt));v.get("/api/geozones/:id",e=>{const t=parseInt(e.req.param("id")),r=Jt.find(i=>i.id===t);if(!r)return e.json({error:"Geozone not found"},404);const s=se.filter(i=>r.vehicleIds.includes(i.id));return e.json({...r,vehicles:s})});v.post("/api/login",async e=>{const t=await e.req.json();return t.username==="admin"&&t.password==="admin"?e.json({success:!0,token:"demo-token-12345"}):e.json({success:!1,message:"Неверный логин или пароль"},401)});v.get("/",e=>e.html(O("html",{lang:"ru",children:[O("head",{children:[O("meta",{charset:"UTF-8"}),O("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),O("title",{children:"Система контроля транспортного отдела"}),O("script",{src:"https://cdn.tailwindcss.com"}),O("link",{href:"https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css",rel:"stylesheet"}),O("script",{src:"https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"}),O("script",{src:"https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"}),O("link",{rel:"stylesheet",href:"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"}),O("script",{src:"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"}),O("link",{href:"/static/style.css",rel:"stylesheet"}),O("script",{children:`
          tailwind.config = {
            darkMode: 'class',
            theme: {
              extend: {
                colors: {
                  primary: '#3b82f6',
                  secondary: '#1e40af',
                  dark: '#0f172a',
                  darker: '#020617'
                }
              }
            }
          }
        `})]}),O("body",{class:"bg-darker text-gray-100",children:[O("div",{id:"app"}),O("script",{src:"/static/app.js"})]})]})));const ft=new Bt,ps=Object.assign({"/src/index.tsx":v});let Zt=!1;for(const[,e]of Object.entries(ps))e&&(ft.all("*",t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),ft.notFound(t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Zt=!0);if(!Zt)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{ft as default};
